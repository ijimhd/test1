<!DOCTYPE html>
<html lang="el">
    <head>
        <meta charset="utf-8">
        <meta name="description" content="xkpfoto">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Xkpfoto</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body>
        <div class="header-container">
            <input type="checkbox" id="sidebar-active">
            <label for="sidebar-active" class="open-sidebar-button">
                <svg xmlns="http://www.w3.org/2000/svg" height="40" viewBox="0 -960 960 960" width="40"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>
            </label>
            <label id="overlay" for="sidebar-active"></label>
            <div class="links-container">
                <label for="sidebar-active" class="close-sidebar-button">
                    <svg xmlns="http://www.w3.org/2000/svg" height="40" viewBox="0 -960 960 960" width="40"><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg>
                </label>                
                <a class="nav-link nav-item" href="./index.html">HOME</a>
                <a class="nav-link nav-item" href="./football.html">FOOTBALL</a>
            </div>
        </div>
        <div class="max-w-6xl mx-auto px-6 py-10">
            <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-6"></div>
        </div>
        <div id="lightbox" class="lightbox hidden">
          <button class="lightbox-close" aria-label="Close image">&times;</button>
          <img id="lightbox-img" alt="">
        </div>


        <script src="gallery-champions.js"></script>
        <script>
        document.addEventListener("DOMContentLoaded", () => {
          const gallery = document.getElementById("gallery");
          const lightbox = document.getElementById("lightbox");
          const lightboxImg = document.getElementById("lightbox-img");
          const closeBtn = document.querySelector(".lightbox-close");

          function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
              const j = Math.floor(Math.random() * (i + 1));
              [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
          }

          function netlifyImage(src, width) {
            return `/.netlify/images?url=${encodeURIComponent(src)}&w=${width}`;
          }

          const widths = [400, 600, 800, 1000, 1200, 1600, 2000];

          const shuffled = shuffleArray([...images]);

          const preloadImages = shuffled.map(src => {
            return new Promise(resolve => {
              const img = new Image();
              img.src = netlifyImage(src, 800);
              img.onload = () => resolve(src);
              img.onerror = () => resolve(null);
            });
          });

          Promise.all(preloadImages).then(readyImages => {
            const fragment = document.createDocumentFragment();

            readyImages.forEach(src => {
              if (!src) return;

              const img = document.createElement("img");

              img.src = netlifyImage(src, 800);
              img.srcset = widths.map(w => `${netlifyImage(src, w)} ${w}w`).join(", ");
              img.sizes = `
                (max-width: 640px) 95vw,
                (max-width: 1024px) 45vw,
                (max-width: 1600px) 30vw,
                25vw
              `;

              img.loading = "lazy";
              img.className = "w-full h-auto rounded-lg shadow-md object-cover fade-in-start";
              img.style.cursor = "zoom-in";

              img.addEventListener("click", () => {
              const isMobile = window.matchMedia("(max-width: 768px)").matches;

              // Mobile: reuse already loaded image (FAST)
              if (isMobile) {
                lightboxImg.src = img.src;
                lightbox.classList.remove("hidden");
                document.body.style.overflow = "hidden";
                return;
              }

              // Desktop: show medium image instantly
              lightboxImg.src = img.src;
              lightboxImg.classList.add("loading");
              lightbox.classList.remove("hidden");
              document.body.style.overflow = "hidden";

              // Load optimized desktop lightbox size (NOT huge)
              const highRes = new Image();
              highRes.src = netlifyImage(src, 1600);

              highRes.onload = () => {
                lightboxImg.src = highRes.src;
                lightboxImg.classList.remove("loading");
              };
            });


              fragment.appendChild(img);
            });

            gallery.appendChild(fragment);

            requestAnimationFrame(() => {
              document.querySelectorAll(".fade-in-start").forEach(img => {
                img.classList.add("loaded");
              });
            });
          });

          // âŒ CLOSE LIGHTBOX
          function closeLightbox() {
            lightbox.classList.add("hidden");
            lightboxImg.src = "";
            document.body.style.overflow = "";
          }

          closeBtn.addEventListener("click", closeLightbox);

          lightbox.addEventListener("click", e => {
            if (e.target === lightbox) closeLightbox();
          });

          document.addEventListener("keydown", e => {
            if (e.key === "Escape") closeLightbox();
          });
        });
        </script>




    </body>
</html>
